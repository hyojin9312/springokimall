<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper 
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.okimall.mappers.reviewMapper">
	
	<!-- 상품후기 총개수 -->
	<select id="countReview" parameterType="int" resultType="int">
		select count(rv_no)
		from review_tb
		where gds_no = #{gds_no}
	</select>
	
	<!-- 상품후기 쓰기 -->
	<insert id="writeReview" parameterType="ReviewVO">
		insert into review_tb(rv_no, mb_id, gds_no, rv_conte, rv_grade, rv_date)
		values(seq_rv_no.nextval, #{mb_id}, #{gds_no}, #{rv_conte}, #{rv_grade}, sysdate)
	</insert>
	
	<!-- 상품후기 리스트(페이지포함) -->
	<select id="listReview" parameterType="Map" resultType="ReviewVO">
		select rv_no, mb_id, gds_no, rv_conte, rv_grade, rv_date
		from(select rv_no, mb_id, gds_no, rv_conte, rv_grade, rv_date,
				row_number() over(order by rv_no desc) p_seq
			from review_tb
			where gds_no=#{gds_no})
		where p_seq between #{cri.rowStart} and #{cri.rowEnd}
	</select>
	
	<!-- 후기 수정 -->
	<update id="modifyReview" parameterType="ReviewVO">
		update review_tb
		set rv_conte=#{rv_conte}, rv_grade=#{rv_grade}
		where rv_no=#{rv_no}
	</update>
	
	<!-- 후기 삭제 -->
	<delete id="deleteReview" parameterType="int">
		delete from review_tb
		where rv_no=#{rv_no}
	</delete>

</mapper>