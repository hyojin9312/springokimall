<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper 
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.okimall.mappers.cartMapper">
	
	<!-- 장바구니 추가 -->
	<insert id="addCart" parameterType="CartVO">
		merge into cart_tb c
		using dual
		on (c.mb_id=#{mb_id} and c.gds_no=#{gds_no})
		when matched then
			update set cart_amount = cart_amount + #{cart_amount}
		when not matched then
			insert(cart_code, gds_no, mb_id, cart_amount)	
			values(seq_cart_code.NEXTVAL, #{gds_no}, #{mb_id}, #{cart_amount})
	</insert>
	
	<!-- 장바구니가져오기 -->
	<select id="getCart" parameterType="string" resultType="com.okimall.domain.CartProductVO">
		<![CDATA[
			select c.cart_code, c.cart_amount, g.gds_no, g.gds_name, g.gds_pric, g.gds_disc, g.gds_imag
			from(select cart_code, gds_no, mb_id, cart_amount 
				from cart_tb
				where mb_id=#{mb_id}) c inner join goods_tb g
			on c.gds_no = g.gds_no
		]]>	
	</select>
	
	<!-- 장바구니 삭제 -->
	<delete id="deleteCart" parameterType="int">
		delete from cart_tb
		where cart_code = #{cart_code}
	</delete>
	
	<!-- 장바구니 수량변경 -->
	<update id="updateCart" parameterType="Map">
		update cart_tb
		set cart_amount = #{cart_amount}
		where cart_code = #{cart_code}
	</update>
	
	<!-- 장바구니 삭제(주문완료) -->
	<delete id="deleteCartOrder" parameterType="Map">
		delete from cart_tb
		where gds_no=#{gds_no} and mb_id=#{mb_id}
	</delete>

</mapper>